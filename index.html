<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Calendar • Three.js</title>
    <style>
      :root {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: linear-gradient(180deg, #ffe8cc 0%, #ffc98e 45%, #f6a55a 100%);
        color: #1b3d91;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      #scene-container {
        flex: 1;
        position: relative;
      }

      canvas {
        display: block;
      }

      .overlay {
        position: absolute;
        inset: 1rem 1rem auto auto;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        text-align: right;
      }

      .overlay span {
        font-size: 0.95rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #c41230;
        text-shadow: 0 2px 4px rgba(255, 255, 255, 0.6);
      }

      .overlay small {
        font-size: 0.75rem;
        letter-spacing: 0.15em;
        color: rgba(27, 61, 145, 0.75);
      }
    </style>
  </head>
  <body>
    <div id="scene-container">
      <div class="overlay">
        <span id="month-label"></span>
        <small>Drag to rotate · Scroll to zoom</small>
      </div>
    </div>

    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/"
        }
      }
    </script>

    <script type="module">
      import * as THREE from 'three';
      import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

      const container = document.getElementById('scene-container');
      const scene = new THREE.Scene();

      const camera = new THREE.PerspectiveCamera(
        45,
        container.clientWidth / container.clientHeight,
        0.1,
        100
      );
      camera.position.set(9, 7.5, 11);

      const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setClearColor(0x000000, 0);
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      const controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;
      controls.target.set(0, 0, 0);
      controls.minDistance = 6;
      controls.maxDistance = 16;
      controls.update();

      const ambient = new THREE.AmbientLight(0xffffff, 0.55);
      scene.add(ambient);

      const dirLight = new THREE.DirectionalLight(0xffffff, 1.1);
      dirLight.position.set(6, 12, 10);
      scene.add(dirLight);

      const monthLabel = document.getElementById('month-label');

      const DAYS_PER_WEEK = 7;
      const WEEKS_VISIBLE = 5;
      const CUBE_SIZE = 1.4;
      const GAP = 0.4;
      const palette = {
        baseRed: '#e5243f',
        warmWhite: '#fff7f2',
        accentBlue: '#1c2c84',
        weekendPink: '#ffccd7',
        weekdaysRed: '#d92032',
        weekendLabel: '#f06a8b',
        todaySunshine: '#ffe066',
        subtleOutline: '#f3a0b8',
      };

      const calendarRig = new THREE.Group();
      scene.add(calendarRig);
      const calendarGroup = new THREE.Group();
      const weekdayGroup = new THREE.Group();
      calendarRig.add(calendarGroup);
      calendarRig.add(weekdayGroup);

      const baseGeometry = new THREE.BoxGeometry(CUBE_SIZE, CUBE_SIZE, CUBE_SIZE);

      const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

      function padTextureText(ctx, label, size) {
        ctx.fillText(label, size / 2, size * 0.6);
      }

      function createDayTexture({ label, active, highlight, weekend }) {
        const size = 512;
        const canvas = Object.assign(document.createElement('canvas'), {
          width: size,
          height: size,
        });
        const ctx = canvas.getContext('2d');

        const background = highlight
          ? palette.todaySunshine
          : weekend
          ? palette.weekendPink
          : active
          ? palette.warmWhite
          : '#f1d9d7';
        const border = highlight ? '#f9c74f' : palette.subtleOutline;

        ctx.fillStyle = background;
        ctx.strokeStyle = border;
        ctx.lineWidth = size * 0.03;
        ctx.fillRect(0, 0, size, size);
        ctx.strokeRect(
          ctx.lineWidth / 2,
          ctx.lineWidth / 2,
          size - ctx.lineWidth,
          size - ctx.lineWidth
        );

        ctx.fillStyle = highlight ? palette.baseRed : palette.accentBlue;
        ctx.font = `bold ${size * 0.48}px 'Inter', 'Segoe UI', sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        padTextureText(ctx, label, size);

        return new THREE.CanvasTexture(canvas);
      }

      function createWeekdayTexture(label, weekend) {
        const size = 512;
        const canvas = Object.assign(document.createElement('canvas'), {
          width: size,
          height: size,
        });
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = weekend ? palette.weekendLabel : palette.weekdaysRed;
        ctx.fillRect(0, 0, size, size);
        ctx.fillStyle = '#fff7f2';
        ctx.font = `700 ${size * 0.36}px 'Inter', 'Segoe UI', sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(label, size / 2, size / 2);
        return new THREE.CanvasTexture(canvas);
      }

      function getCalendarCells(baseDate = new Date()) {
        const today = new Date(baseDate.getFullYear(), baseDate.getMonth(), baseDate.getDate());
        const firstOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
        const startOffset = firstOfMonth.getDay();
        const gridStart = new Date(firstOfMonth);
        gridStart.setDate(firstOfMonth.getDate() - startOffset);

        monthLabel.textContent = today.toLocaleString('default', {
          month: 'long',
          year: 'numeric',
        });

        const cells = [];
        for (let i = 0; i < DAYS_PER_WEEK * WEEKS_VISIBLE; i += 1) {
          const date = new Date(gridStart);
          date.setDate(gridStart.getDate() + i);
          cells.push({
            date,
            inMonth: date.getMonth() === today.getMonth(),
            isToday: date.getTime() === today.getTime(),
            weekend: date.getDay() === 0 || date.getDay() === 6,
          });
        }
        return cells;
      }

      function createCalendar(baseDate = new Date()) {
        calendarGroup.clear();
        weekdayGroup.clear();

        const cells = getCalendarCells(baseDate);
        const totalWidth = DAYS_PER_WEEK * (CUBE_SIZE + GAP);
        const totalHeight = WEEKS_VISIBLE * (CUBE_SIZE + GAP);
        const startX = -totalWidth / 2 + (CUBE_SIZE + GAP) / 2;
        const startY = totalHeight / 2 - (CUBE_SIZE + GAP) / 2;

        cells.forEach((cell, idx) => {
          const col = idx % DAYS_PER_WEEK;
          const row = Math.floor(idx / DAYS_PER_WEEK);
          const texture = createDayTexture({
            label: cell.date.getDate().toString(),
            active: cell.inMonth,
            highlight: cell.isToday,
            weekend: cell.weekend,
          });

          const material = new THREE.MeshStandardMaterial({
            map: texture,
            color: 0xffffff,
            metalness: 0.05,
            roughness: 0.6,
          });

          const cube = new THREE.Mesh(baseGeometry, material);
          cube.position.set(
            startX + col * (CUBE_SIZE + GAP),
            startY - row * (CUBE_SIZE + GAP),
            0
          );
          cube.castShadow = true;
          cube.receiveShadow = true;
          calendarGroup.add(cube);
        });

        // Weekday labels sit slightly above cubes
        weekdays.forEach((day, idx) => {
          const spriteMap = createWeekdayTexture(day, idx === 0 || idx === 6);
          const material = new THREE.MeshBasicMaterial({ map: spriteMap, transparent: true });
          const plane = new THREE.Mesh(new THREE.PlaneGeometry(CUBE_SIZE, CUBE_SIZE * 0.4), material);
          plane.position.set(
            startX + idx * (CUBE_SIZE + GAP),
            startY + CUBE_SIZE,
            0
          );
          weekdayGroup.add(plane);
        });
      }

      createCalendar(new Date());

      window.addEventListener('resize', onResize);

      function onResize() {
        const { clientWidth, clientHeight } = container;
        camera.aspect = clientWidth / clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(clientWidth, clientHeight);
      }

      function animate() {
        requestAnimationFrame(animate);
        calendarRig.rotation.y += 0.0005;
        calendarRig.rotation.x = THREE.MathUtils.lerp(calendarRig.rotation.x, 0.1, 0.02);
        controls.update();
        renderer.render(scene, camera);
      }

      animate();
    </script>
  </body>
</html>
